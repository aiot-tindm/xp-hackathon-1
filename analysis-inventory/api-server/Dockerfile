# Dockerfile cho API Server Service
# Cháº¡y api.py Ä‘á»ƒ cung cáº¥p REST API

FROM python:3.11-slim

# Thiáº¿t láº­p metadata
LABEL maintainer="Analytics Team"
LABEL description="Docker container cho API Server Service - cháº¡y api.py"

# Thiáº¿t láº­p working directory
WORKDIR /app

# CÃ i Ä‘áº·t system dependencies
RUN apt-get update && apt-get install -y \
    gcc \
    default-libmysqlclient-dev \
    pkg-config \
    && rm -rf /var/lib/apt/lists/*

# Copy requirements
COPY ../requirements.txt .

# CÃ i Ä‘áº·t Python dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Copy toÃ n bá»™ source code
COPY ../package ./package
COPY ../api-server ./api-server

# Táº¡o thÆ° má»¥c logs
RUN mkdir -p /app/logs

# Thiáº¿t láº­p environment variables
ENV PYTHONPATH=/app
ENV PYTHONUNBUFFERED=1
ENV FLASK_ENV=production

# Expose port
EXPOSE 5000

# Táº¡o script entrypoint
RUN echo '#!/bin/bash\n\
echo "ðŸš€ Khá»Ÿi Ä‘á»™ng API Server..."\n\
echo "ðŸŒ API server sáº½ cháº¡y táº¡i http://localhost:5000"\n\
echo "ðŸ“Š CÃ¡c endpoints cÃ³ sáºµn:"\n\
echo "   - GET /api/daily-sales"\n\
echo "   - GET /api/top-selling-items"\n\
echo "   - GET /api/category-summary"\n\
echo "   - GET /api/brand-summary"\n\
echo "   - GET /api/refund-analysis"\n\
echo "   - GET /api/low-stock-alerts"\n\
echo "   - GET /api/slow-moving-items"\n\
echo "   - GET /api/summary/overview"\n\
cd /app/api-server\n\
python api.py\n\
' > /app/entrypoint.sh && chmod +x /app/entrypoint.sh

# Thiáº¿t láº­p entrypoint
ENTRYPOINT ["/app/entrypoint.sh"] 